<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LOGIKART - Carte des Prestataires</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
  <header>
    <img src="logikart-logo.png" alt="LOGIKART" style="height: 60px; margin-bottom: 10px;" />
    <h1>LOGIKART - Carte des Prestataires</h1>
    <div style="opacity:.95; font-size:14px; margin-top:6px;">RÃ©seau de prestataires informatiques</div>

    <div id="burgerMenu" aria-label="Menu">
      â˜°
      <div id="menuDropdown" class="hidden" role="menu">
        <ul>
          <li onclick="toggleProviderList()">ğŸ“‹ Prestataires</li>
          <li onclick="openItineraryTool()">ğŸ§­ Calculer un itinÃ©raire</li>
          <li onclick="openReportForm()">ğŸ“ Imprimer rapport dâ€™intervention</li>
          <li onclick="openImportTechnicians()">ğŸ“¥ Importer</li>
          <li onclick="exportTechnicians()">ğŸ“¤ Exporter</li>
        </ul>
      </div>
    </div>
  </header>

  <section class="topbar">
    <input type="text" id="cityInput" placeholder="Ville" />
    <button type="button" onclick="searchNearest()">Rechercher</button>
    <button type="button" onclick="addProvider()">Ajouter un prestataire</button>
  </section>

  <div id="map"></div>

  <!-- Input cachÃ© pour import techniciens -->
  <input type="file" id="technicianFileInput" accept=".csv,.txt,.json" style="display:none" />

  <!-- Formulaire modal d'ajout de prestataire -->
  <div id="providerFormSection" class="modal-overlay">
    <div class="modal-content">
      <form id="providerForm">
        <h2>Ajouter un prestataire</h2>
        <input type="text" id="companyName" placeholder="RAISON SOCIALE" required />
        <input type="text" id="contactName" placeholder="NOM" required />
        <input type="text" id="firstName" placeholder="PRÃ‰NOM" required />
        <input type="text" id="address" placeholder="ADRESSE POSTALE" required />
        <input type="email" id="email" placeholder="ADRESSE EMAIL" required />
        <input type="tel" id="phone" placeholder="NÂ° DE TÃ‰LÃ‰PHONE" required />
        <input type="number" id="rate" placeholder="Tarif heure HT (â‚¬)" step="0.01" required />
        <input type="number" id="travelFees" placeholder="Frais de dÃ©placement HT (â‚¬)" step="0.01" required />
        <input type="text" id="totalCost" placeholder="Tarif total HT (â‚¬)" readonly />

        <div class="form-buttons sticky">
          <button type="submit">Enregistrer</button>
          <button type="button" onclick="hideForm()">Annuler</button>
        </div>
      </form>

      <script>
        const rateInput = document.getElementById("rate");
        const travelInput = document.getElementById("travelFees");
        const totalInput = document.getElementById("totalCost");

        function updateTotal() {
          const rate = parseFloat(rateInput.value) || 0;
          const travel = parseFloat(travelInput.value) || 0;
          totalInput.value = (rate + travel).toFixed(2) + " â‚¬";
        }

        rateInput.addEventListener("input", updateTotal);
        travelInput.addEventListener("input", updateTotal);
      </script>
    </div>
  </div>

  <!-- Liste des prestataires -->
  <aside id="providerList" style="display: none;"></aside>

  <!-- Rapport dâ€™intervention LOGIKART -->
  <div id="reportModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeReportForm()">Ã—</span>

      <form id="reportForm">
        <img src="logikart-logo.png" alt="LOGIKART" class="logo" style="height: 60px;" />
        <h2>Rapport dâ€™intervention LOGIKART</h2>

        <label>NumÃ©ro de ticket :</label>
        <input type="text" name="ticket" required />

        <label>Date dâ€™intervention :</label>
        <input type="date" name="interventionDate" required />

        <label>Adresse du site :</label>
        <input type="text" name="siteAddress" required />

        <label>Nom du technicien :</label>
        <input type="text" name="technician" list="technicianList" required />
        <datalist id="technicianList"></datalist>

        <label>Travail Ã  faire :</label>
        <textarea name="todo" rows="6" required></textarea>

        <label>Travail effectuÃ© :</label>
        <textarea name="done" rows="10" required></textarea>

        <label>Heure dâ€™arrivÃ©e :</label>
        <input type="time" name="start" required />

        <label>Heure de dÃ©part :</label>
        <input type="time" name="end" required />

        <label>Signature du technicien :</label>
        <input type="text" name="signTech" />

        <label>Signature du client :</label>
        <input type="text" name="signClient" />

        <div class="form-buttons sticky">
          <button type="button" onclick="generatePDF()">ğŸ“„ GÃ©nÃ©rer PDF</button>
          <button type="button" onclick="closeReportForm()">âŒ Fermer</button>
        </div>
      </form>

      <div id="reportContent" style="display:none;"></div>
    </div>
  </div>

  <!-- FenÃªtre modale pour l'itinÃ©raire -->
  <div id="itineraryModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeItineraryModal()">Ã—</span>
      <h2>ğŸ§­ Calcul d'itinÃ©raire</h2>

      <form id="itineraryForm">
        <label>Adresse de dÃ©part :</label>
        <input type="text" id="startAddress" required />

        <label>Adresse de destination :</label>
        <input type="text" id="endAddress" required />

        <div id="extraDestinations"></div>

        <div class="form-buttons">
          <button type="button" onclick="addDestinationField()">â• Ajouter une destination</button>
          <button type="button" onclick="calculateRoute()">ğŸš— Calculer lâ€™itinÃ©raire</button>
        </div>
      </form>

      <div id="routeResult" style="margin-top: 15px;"></div>
      <div class="form-buttons sticky">
        <button type="button" onclick="exportItineraryToPDF()" style="display:none" id="exportPdfBtn">ğŸ“„ Exporter en PDF</button>
        <button type="button" onclick="closeItineraryModal()">âŒ Fermer</button>
      </div>
    </div>
  </div>

  <!-- Libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://unpkg.com/leaflet-image/leaflet-image.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Script principal -->
  <script src="script.js"></script>
</body>
</html>
