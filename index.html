from pathlib import Path

# === INDEX.HTML corrigé ===
index_html = """<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOGIKART</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <img src="logikart-logo.png" alt="LOGIKART" style="height:40px; justify-self:start;" />
    <h1 id="pageTitle">LOGIKART - Réseau de prestataires informatiques</h1>
    <button id="burgerMenu" aria-label="menu">☰</button>
  </header>

  <main>
    <!-- Boutons principaux -->
    <section id="actions">
      <button onclick="openProviderForm()">Prestataires</button>
      <button onclick="openItineraryTool()">Calculer un itinéraire</button>
      <button onclick="openReportForm()">Imprimer rapport d’intervention</button>
    </section>

    <!-- Modal Itinéraire -->
    <div id="itineraryModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeItineraryModal()">&times;</span>
        <h2>Calcul d'itinéraire</h2>
        <form id="itineraryForm" onsubmit="event.preventDefault(); calculateRoute();">
          <input type="text" id="startAddress" placeholder="Adresse de départ">
          <div id="extraDestinations"></div>
          <input type="text" id="endAddress" placeholder="Adresse d'arrivée">
          <div class="itinerary-actions">
            <button type="button" onclick="addDestinationField()">Ajouter une étape</button>
            <button type="submit">Calculer l'itinéraire</button>
            <button type="button" id="exportPdfBtn" style="display:none" onclick="exportItineraryToPDF()">Exporter en PDF</button>
          </div>
          <div id="routeResult"></div>
        </form>
      </div>
    </div>

    <!-- Modal Rapport d’intervention -->
    <div id="reportModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeReportForm()">&times;</span>
        <h2>Rapport d’intervention</h2>
        <form id="reportForm">
          <label>N° Ticket <input type="text" name="ticket"></label>
          <label>Date <input type="date" name="interventionDate"></label>
          <label>Adresse du site <input type="text" name="siteAddress"></label>
          <label>Technicien <input type="text" name="technician"></label>
          <label>Travaux à réaliser <textarea name="todo"></textarea></label>
          <label>Travaux réalisés <textarea name="done"></textarea></label>
          <label>Heure de début <input type="time" name="start"></label>
          <label>Heure de fin <input type="time" name="end"></label>
          <label>Signature technicien <input type="text" name="signTech"></label>
          <label>Signature client <input type="text" name="signClient"></label>
          <div class="report-actions">
            <button type="button" onclick="printReport()">Imprimer</button>
            <button type="button" onclick="generatePDF()">Générer PDF</button>
          </div>
        </form>
        <div id="reportContent"></div>
      </div>
    </div>
  </main>

  <script src="script.js"></script>
</body>
</html>
"""

# === STYLE.CSS corrigé ===
style_css = """body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #f9f9f9;
  color: #333;
}

/* --- Header centré avec logo et burger --- */
header {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 1000;
  border-bottom: 1px solid #eee;
}
header h1 {
  grid-column: 2;
  margin: 0;
  text-align: center;
  color: #004080;
}
#burgerMenu {
  grid-column: 3;
  justify-self: end;
  background: #004080;
  color: #fff;
  border: 1px solid #00285a;
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 22px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* Modals génériques */
.modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%; }
.close { float:right; font-size: 22px; cursor: pointer; }

/* Formulaires */
form label { display:block; margin: 8px 0; }
form input, form textarea { width:100%; padding:6px; margin-top:4px; box-sizing:border-box; }

/* Boutons itinéraire côte à côte */
.itinerary-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px; }
.itinerary-actions button { white-space:nowrap; }

/* Boutons rapport */
.report-actions { display:flex; gap:10px; margin-top:12px; }
"""

# === SCRIPT.JS corrigé ===
script_js = """// Ouverture Rapport
function openReportForm() {
  const modal = document.getElementById("reportModal");
  if (!modal) return;
  modal.style.display = "flex";
  const reportContent = document.getElementById("reportContent");
  if (reportContent) { reportContent.innerHTML = ""; reportContent.style.display = "none"; }
}

// Fermeture Rapport
function closeReportForm() {
  const modal = document.getElementById("reportModal");
  if (modal) modal.style.display = "none";
}

// Impression directe
function printReport() {
  const form = document.getElementById("reportForm");
  const get = id => form.querySelector(`[name="${id}"]`);
  const values = {
    ticket: get("ticket")?.value,
    date: get("interventionDate")?.value,
    site: get("siteAddress")?.value,
    tech: get("technician")?.value,
    todo: get("todo")?.value,
    done: get("done")?.value,
    start: get("start")?.value,
    end: get("end")?.value,
    signTech: get("signTech")?.value,
    signClient: get("signClient")?.value
  };

  const html = buildReportHTML(values);
  const w = window.open("", "_blank");
  w.document.open();
  w.document.write(`<html><head><meta charset="utf-8"><title>Rapport</title></head><body>${html}</body></html>`);
  w.document.close();
  w.focus();
  w.print();
}

// Génération PDF via print (évite blanc)
function generatePDF() {
  const form = document.getElementById("reportForm");
  const get = id => form.querySelector(`[name="${id}"]`);
  const values = {
    ticket: get("ticket")?.value || "",
    date: get("interventionDate")?.value || "",
    site: get("siteAddress")?.value || "",
    tech: get("technician")?.value || "",
    todo: get("todo")?.value || "",
    done: get("done")?.value || "",
    start: get("start")?.value || "",
    end: get("end")?.value || "",
    signTech: get("signTech")?.value || "",
    signClient: get("signClient")?.value || ""
  };

  const html = buildReportHTML(values);
  const w = window.open("", "_blank");
  w.document.open();
  w.document.write(`<html><head><meta charset="utf-8"><title>Rapport</title></head><body>${html}</body></html>`);
  w.document.close();
  w.focus();
  w.print();
}

// Construction du HTML Rapport
function buildReportHTML(values){
  return `
    <h2>Rapport d’intervention</h2>
    <p><b>Ticket:</b> ${values.ticket}</p>
    <p><b>Date:</b> ${values.date}</p>
    <p><b>Site:</b> ${values.site}</p>
    <p><b>Technicien:</b> ${values.tech}</p>
    <p><b>Travaux à réaliser:</b><br>${values.todo}</p>
    <p><b>Travaux réalisés:</b><br>${values.done}</p>
    <p><b>Heure début:</b> ${values.start} - <b>Heure fin:</b> ${values.end}</p>
    <p><b>Signature tech:</b> ${values.signTech}</p>
    <p><b>Signature client:</b> ${values.signClient}</p>
  `;
}

// Itinéraire placeholder functions
function openItineraryTool(){ document.getElementById("itineraryModal").style.display="flex"; }
function closeItineraryModal(){ document.getElementById("itineraryModal").style.display="none"; }
function addDestinationField(){
  const div = document.createElement("input");
  div.type="text"; div.placeholder="Étape intermédiaire";
  document.getElementById("extraDestinations").appendChild(div);
}
function calculateRoute(){ document.getElementById("routeResult").innerText="Itinéraire calculé (simulation)"; }
function exportItineraryToPDF(){ alert("Export PDF itinéraire non encore implémenté"); }
"""

# Écrire les fichiers
Path("/mnt/data/index.html").write_text(index_html, encoding="utf-8")
Path("/mnt/data/style.css").write_text(style_css, encoding="utf-8")
Path("/mnt/data/script.js").write_text(script_js, encoding="utf-8")

print("Fichiers corrigés créés : index.html, style.css, script.js")
