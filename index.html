<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LOGIKART - Carte des Prestataires</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
  <header style="display: flex; flex-direction: column; align-items: center; padding: 20px;">
    <img src="logikart-logo.png" alt="LOGIKART" style="height: 60px; margin-bottom: 10px;" />
    <h1 style="text-align: center;">LOGIKART - RÃ©seau de prestataires informatiques</h1>
    <div id="burgerMenu">
      â˜°
      <div id="menuDropdown" class="hidden">
        <ul>
          <li onclick="toggleProviderList()">ğŸ“‹ Prestataires</li>
          <li onclick="openItineraryTool()">ğŸ§­ Calculer un itinÃ©raire</li>
          <li onclick="openReportForm()">ğŸ“ Imprimer rapport dâ€™intervention</li>
        </ul>
      </div>
    </div>
  </header>

  <section style="padding: 10px; display: flex; gap: 10px; justify-content: center;">
    <input type="text" id="cityInput" placeholder="Ville" style="width: 250px; padding: 8px;" />
    <button onclick="searchNearest()">Rechercher</button>
    <button onclick="addProvider()">Ajouter un prestataire</button>
  </section>

  <div id="map" style="width: 100%; height: 80vh;"></div>

  <!-- Formulaire modal d'ajout de prestataire -->
  <div id="providerFormSection" class="modal-overlay">
    <div class="modal-content">
      <form id="providerForm">
        <h2>Ajouter un prestataire</h2>
        <input type="text" id="companyName" placeholder="RAISON SOCIALE" required />
        <input type="text" id="contactName" placeholder="NOM" required />
        <input type="text" id="firstName" placeholder="PRÃ‰NOM" required />
        <input type="text" id="address" placeholder="ADRESSE POSTALE" required />
        <input type="email" id="email" placeholder="ADRESSE EMAIL" required />
        <input type="tel" id="phone" placeholder="NÂ° DE TÃ‰LÃ‰PHONE" required />
        <input type="number" id="rate" placeholder="Tarif heure HT (â‚¬)" step="0.01" required />
        <input type="number" id="travelFees" placeholder="Frais de dÃ©placement HT (â‚¬)" step="0.01" required />
        <input type="text" id="totalCost" placeholder="Tarif total HT (â‚¬)" readonly />
        <button type="submit">Enregistrer</button>
        <button type="button" onclick="hideForm()">Annuler</button>
      </form>
      <script>
        const rateInput = document.getElementById("rate");
        const travelInput = document.getElementById("travelFees");
        const totalInput = document.getElementById("totalCost");

        function updateTotal() {
          const rate = parseFloat(rateInput.value) || 0;
          const travel = parseFloat(travelInput.value) || 0;
          totalInput.value = (rate + travel).toFixed(2) + " â‚¬";
        }

        rateInput.addEventListener("input", updateTotal);
        travelInput.addEventListener("input", updateTotal);
      </script>
    </div>
  </div>

  <!-- Liste des prestataires -->
  <aside id="providerList" style="display: none;"></aside>

  <!-- Rapport dâ€™intervention LOGIKART -->
  <div id="reportModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeReportForm()">Ã—</span>

      <form id="reportForm">
        <img src="logikart-logo.png" alt="LOGIKART" class="logo" style="height: 60px;" />
        <h2>Rapport dâ€™intervention LOGIKART</h2>

        <label for="ticket">NumÃ©ro de ticket :</label>
        <input type="text" name="ticket" required />

        <label for="interventionDate">Date dâ€™intervention :</label>
        <input type="date" name="interventionDate" required />

        <label for="siteAddress">Adresse du site :</label>
        <input type="text" name="siteAddress" required />

        <label for="technician">Nom du technicien :</label>
        <input type="text" name="technician" list="technicianList" required />
		<datalist id="technicianList"></datalist>

        <label for="todo">Travail Ã  faire :</label>
        <textarea name="todo" rows="6" required></textarea>

        <label for="done">Travail effectuÃ© :</label>
        <textarea name="done" rows="10" required></textarea>

        <label for="start">Heure dâ€™arrivÃ©e :</label>
        <input type="time" name="start" required />

        <label for="end">Heure de dÃ©part :</label>
        <input type="time" name="end" required />

        <label for="signTech">Signature du technicien :</label>
        <input type="text" name="signTech" />

        <label for="signClient">Signature du client :</label>
        <input type="text" name="signClient" />

        <div class="form-buttons">
          <button type="button" onclick="generatePDF()">ğŸ“„ GÃ©nÃ©rer PDF</button>
          <button type="button" onclick="closeReportForm()">âŒ Fermer</button>
        </div>
      </form>

      <div id="reportContent" style="display: none;"></div>
    </div>
  </div>
  
<!-- FenÃªtre modale pour l'itinÃ©raire -->
<div id="itineraryModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeItineraryModal()">Ã—</span>
    <h2>ğŸ§­ Calcul d'itinÃ©raire</h2>
    <form id="itineraryForm">
      <label>Adresse de dÃ©part :</label>
      <input type="text" id="startAddress" required />

      <label>Adresse de destination :</label>
      <input type="text" id="endAddress" required />

      <div id="extraDestinations"></div>

      <button type="button" onclick="addDestinationField()">â• Ajouter une destination</button>
      <button type="button" onclick="calculateRoute()">ğŸš— Calculer lâ€™itinÃ©raire</button>
    </form>

    <div id="routeResult" style="margin-top: 15px;"></div>
	<button type="button" onclick="exportItineraryToPDF()" style="margin-top: 10px; display: none;" id="exportPdfBtn">ğŸ“„ Exporter en PDF</button>
  </div>
</div>

  <!-- Script principal -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://unpkg.com/leaflet-image/leaflet-image.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
